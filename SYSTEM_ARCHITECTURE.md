# 专家评分系统架构说明

## 系统概览

专家评分系统是一个基于Flask的Web应用，用于支持科研假设的专家评估。系统采用"并排比较法"，让专家通过左右对比的方式对假设进行多维度评分。

## 核心组件

### 1. 后端架构 (Flask)
```
app.py
├── 路由管理
│   ├── / (主页)
│   ├── /rate/<topic> (主题评估页)
│   ├── /thank-you (感谢页)
│   ├── /admin/ratings (管理员页面)
│   └── API端点
│       ├── /api/submit-rating (提交评分)
│       └── /api/submit-comment (提交评论)
├── 数据模型
│   ├── 假设池管理 (TOPIC_HYPOTHESIS_POOLS)
│   ├── 会话管理 (Flask Session)
│   └── 数据库操作
└── 业务逻辑
    ├── 假设配对算法
    ├── 评分验证
    └── 数据持久化
```

### 2. 前端架构
```
templates/
├── base.html (基础模板)
├── index.html (主页)
├── rate_topic.html (评估页面)
├── thank_you.html (感谢页)
└── admin_ratings.html (管理员页面)

static/
├── css/style.css (样式文件)
└── js/app.js (JavaScript逻辑)
```

### 3. 数据库架构
```
hypothesis_data.db
├── hypothesis (原有表)
│   ├── id (主键)
│   ├── topic (主题ID)
│   ├── hypothesis_content (假设内容JSON)
│   └── ... (其他字段)
├── ratings (新增表)
│   ├── rating_id (主键)
│   ├── session_id (会话ID)
│   ├── topic_name (主题名称)
│   ├── comparison_number (比较编号)
│   ├── hypothesis_A_id (假设A ID)
│   ├── hypothesis_B_id (假设B ID)
│   ├── novelty_score (新颖性评分)
│   ├── soundness_score (合理性评分)
│   ├── feasibility_score (可行性评分)
│   ├── significance_score (重要性评分)
│   ├── overall_score (总体评分)
│   └── timestamp (时间戳)
└── comments (新增表)
    ├── comment_id (主键)
    ├── session_id (会话ID)
    ├── topic_name (主题名称)
    ├── comment_text (评论内容)
    └── timestamp (时间戳)
```

## 数据流程

### 1. 系统初始化流程
```
启动应用
├── 连接数据库
├── 初始化假设池
│   └── 为每个主题随机选择10条固定假设
├── 创建评分相关数据表
└── 启动Web服务器
```

### 2. 专家评估流程
```
专家访问系统
├── 选择主题 (/rate/topic1)
├── 初始化会话
│   ├── 生成唯一session_id
│   ├── 设置当前比较编号
│   └── 初始化完成比较列表
├── 进行8次比较
│   ├── 获取假设对 (get_comparison_pair)
│   ├── 显示假设内容
│   ├── 专家评分 (5个维度)
│   ├── 提交评分 (/api/submit-rating)
│   └── 更新会话状态
├── 完成所有比较
├── 跳转感谢页面
├── 可选提交评论
└── 结束评估会话
```

### 3. 假设配对算法
```
get_comparison_pair(topic, comparison_number)
├── 获取主题的固定假设池 (10条假设)
├── 使用比较编号作为随机种子
├── 随机选择2个不同假设
└── 返回假设对
```

## 关键技术特性

### 1. 固定假设池机制
- **目的**: 确保同一主题的所有专家评估相同的假设集
- **实现**: 系统启动时一次性随机选择，存储在内存中
- **优势**: 保证评估的一致性和可比性

### 2. 会话管理
- **会话ID**: 使用UUID确保唯一性
- **状态跟踪**: 记录当前比较编号和完成状态
- **数据关联**: 所有评分数据通过session_id关联

### 3. 评分验证
- **前端验证**: JavaScript实时检查评分完整性
- **后端验证**: Python验证数据格式和范围
- **双重保障**: 确保数据质量和用户体验

### 4. 响应式设计
- **Bootstrap框架**: 提供现代化的UI组件
- **移动适配**: 支持各种屏幕尺寸
- **用户体验**: 内容展开/收起、进度条、加载状态

## 部署架构

### 开发环境
```
本地开发
├── Python虚拟环境 (venv/)
├── SQLite数据库 (hypothesis_data.db)
├── Flask开发服务器 (localhost:5001)
└── 热重载支持
```

### 生产环境 (建议)
```
云端部署
├── 应用服务器 (如Railway, Heroku)
├── 数据库 (PostgreSQL/MySQL)
├── 静态文件CDN
├── 反向代理 (Nginx)
└── SSL证书
```

## 扩展性设计

### 1. 水平扩展
- **无状态设计**: 会话数据存储在数据库中
- **负载均衡**: 支持多实例部署
- **数据库分离**: 可独立扩展数据库层

### 2. 功能扩展
- **专家认证**: 可添加登录系统
- **多语言**: 支持国际化
- **数据分析**: 集成可视化组件
- **批量操作**: 支持批量导入导出

### 3. 性能优化
- **缓存机制**: 假设池数据可缓存
- **异步处理**: 评分提交可异步化
- **数据压缩**: 大文本内容压缩存储

## 安全考虑

### 1. 数据安全
- **输入验证**: 严格的参数验证
- **SQL注入防护**: 使用参数化查询
- **XSS防护**: 模板自动转义

### 2. 会话安全
- **会话密钥**: 使用安全的随机密钥
- **会话超时**: 可配置会话过期时间
- **CSRF防护**: 可添加CSRF令牌

### 3. 访问控制
- **管理员权限**: 评分数据访问控制
- **API限制**: 可添加频率限制
- **日志记录**: 操作日志追踪

## 监控和维护

### 1. 系统监控
- **应用日志**: Flask内置日志系统
- **数据库监控**: 查询性能和连接状态
- **用户行为**: 页面访问和评分统计

### 2. 数据备份
- **定期备份**: 数据库自动备份
- **版本控制**: 代码版本管理
- **灾难恢复**: 备份恢复策略

### 3. 性能调优
- **数据库索引**: 优化查询性能
- **缓存策略**: 减少数据库负载
- **代码优化**: 性能分析和优化

这个架构设计确保了系统的可靠性、可扩展性和易维护性，为科研假设评估提供了一个稳定高效的平台。
